export EDITOR=vim
export VISUAL="$EDITOR"
export LC_ALL="en_US.UTF-8"
export MANWIDTH=80
export PATH="$HOME/bin:$HOME/Library/Python/3.8/bin:$PATH"

umask 022

alias l="ls -F"
alias la="ls -AF"
alias ll="ls -ltrh"

alias less="less -i"

alias mv="mv -i"
alias cp="cp -i"
alias ln="ln -i"

# Use extended regular expressions, following the model of `egrep`.
if find -E .  -maxdepth 0 > /dev/null 2>&1; then
  alias efind="find -E"
else
  function efind {
    find "$@" -regextype posix-extended
  }
fi
alias esed="sed -r"

if which otool > /dev/null; then
  alias dis="otool -tV"
elif which objdump > /dev/null; then
  alias dis="objdump -Mintel -d"
fi

function 2null {
  $@ 2> /dev/null
}

function d {
  if test $# -gt 0; then
    cd "$1" || cd $(2null efind ~ -maxdepth 2 -type d -not -path '*/.*' -iregex '.*'"$1"'.*' | head -n1)
  fi
  list
}

function get_icon {
  icon=""
  if test -d "$1"; then
    icon="📁"
  elif test -x "$1"; then
    icon="⚡"
  else
    extension="$(echo "${1##*.}" | tr A-Z a-z)"
    case "$extension" in
      aif|aiff|au|mp3|m4a|wav|wave)
        icon="🎧"
        ;;
      gif|jpg|jpeg|png|tif|tiff)
        icon="🖼"
        ;;
      pdf|ps)
        icon="📜"
        ;;
      md|rtf|text|tex|txt)
        icon="📄"
        ;;
      db|sql|sqlite)
        icon="🗄"
        ;;
      bat|c|cc|cpp|h|hpp|go|js|lisp|lsp|py|rs|sh)
        icon="⚙️"
        ;;
      json|plist|xml)
        icon="🔩"
        ;;
      bz2|cab|dmg|dpkg|gz|jar|msi|pkg|rar|rpm|tar|xz|z|zip)
        icon="📦"
        ;;
      *)
        icon=""
        ;;
    esac
  fi
  echo "$icon"
}

function tree {
  find "$@" | while read pathname; do
    if echo "$pathname" | grep -q '/\.'; then
      continue
    fi

    indented=$(echo "$pathname" | sed 's,[^/]*/,    ,g')

    if test -L "$pathname"; then
      target=$(readlink "$pathname")
      icon="→ $(get_icon "$target")"
    else
      icon=$(get_icon "$pathname")
    fi

    echo "$indented $icon"
  done
}

function t {
  test $# -gt 0 && tree "$@" || tree .
}

function = {
  echo "$*" | bc -l
}

function get {
  less -i -p "$1" "$2"
}

function searchc {
  search -n '!/out/' -n '\.(h|c|cpp|cc|m|mm)$' "$@"
}

function hgrep {
  history | grep -i "$@" | tail -n 10
}

source "$HOME"/bin/lib.sh

test -f "$HOME/.local_profile" && source "$HOME/.local_profile"
