#!/usr/bin/env bash

help="List file information. Synopsis:

  list [-hmnpst] [directory...]

Options:

  -h  Show this help message.
  -m  Print last modified time in the 1st column.
  -n  Print name in the 1st column.
  -p  Print permissions in the 1st column.
  -s  Print size in the 1st column.
  -t  Print type in the 1st column."

source "$HOME"/bin/script.sh

GREEN_FG=
NORMAL=
if [[ -t 1 ]]; then
  GREEN_FG="$(tput setaf 2 || echo)"
  NORMAL="$(tput sgr0 || echo)"
fi

if [[ $(uname) = "Linux" ]]; then
  is_linux="true"
  time_format=""
  format="$GREEN_FG%y  %A  %12s  %12F$NORMAL %N"
  if [[ $# -gt 0 ]]; then
    case "$1" in
      -m)
        shift ;;
      -n)
        format="%40N $GREEN_FG%12F %y  %A  %12s$NORMAL"
        shift ;;
      -p)
        format="$GREEN_FG%A  %y  %12s  %12F$NORMAL %N"
        shift ;;
      -s)
        format="$GREEN_FG%12s  %y  %A  %12F$NORMAL %N"
        shift ;;
      -t)
        format="$GREEN_FG%12F$NORMAL %-40N  $GREEN_FG%y  %A  %12s$NORMAL"
        shift ;;
      -h)
        echo "$help"
        exit 1
    esac
  fi
else
  is_linux="false"
  time_format="%Y-%m-%d %H:%M:%S"
  format="$GREEN_FG%Sm  %Sp  %12z  %1T$NORMAL %N"
  if [[ $# -gt 0 ]]; then
    case "$1" in
      -m)
        shift ;;
      -n)
        format="%40N $GREEN_FG%1T %Sm  %Sp  %12z$NORMAL"
        shift ;;
      -p)
        format="$GREEN_FG%Sp  %Sm  %12z  %1T$NORMAL %N"
        shift ;;
      -s)
        format="$GREEN_FG%12z  %Sm  %Sp  %1T$NORMAL %N"
        shift ;;
      -t)
        format="$GREEN_FG%1T$NORMAL %-40N  $GREEN_FG%Sm  %Sp  %12z$NORMAL"
        shift ;;
      -h)
        echo "$help"
        exit 1
    esac
  fi
fi

status() {
  if [[ "$is_linux" = true ]]; then
    stat -c "$format" "$@"
  else
    stat -t "$time_format" -f "$format" "$@"
  fi
}

if [[ $# -eq 0 ]]; then
  status *
else
  for p in "$@"; do
    [[ -f "$p" ]] && status "$p" || status "$p"/*
  done
fi | sort
